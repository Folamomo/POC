
clearvars;
clear all;
clc;

%%

image = zeros(11,11);
image(7,2) = 1;

[H,tehta,ro] = hough(image,'RhoResolution',0.1,'ThetaResolution',0.5);

image(5,6) = 1;

[H2,tehta2,ro2] = hough(image,'RhoResolution',0.1,'ThetaResolution',0.5);

figure(1);
subplot(1,3,1); imshow(image);      title('oryginal');
subplot(1,3,2); imshow(H,[]);       title('hough');
subplot(1,3,3); imshow(H2,[]);       title('hough 2');

%%
image = zeros(11,11);
image(7,2) = 1;
image(5,11) = 1;
image(1,1) = 1;
image(4,6) = 1;

[H,theta,rho] = hough(image,'RhoResolution',0.1,'ThetaResolution',0.5);

figure(2);
subplot(1,1,1); imshow(H,[]);
%%
rho1 = rho(143);
theta1 = theta(163);
%%
x = 0:0.1:10;

y = (rho1 - x*cosd(theta1)/sind(theta1));
figure(3);
imshow(image);
hold on;
plot(x+1,y+1);

%%
%czyścimy zmienne
clearvars;
clear all;
clc;

image = imread('kwadraty.png');
imageEdge = edge(image,'canny');

figure(1);
subplot(1,2,1); imshow(image);
subplot(1,2,2); imshow(imageEdge);

[H,theta,rho] = hough(imageEdge,'RhoResolution',1,'ThetaResolution',1);
peaks = houghpeaks(H,10);

figure(2);
imshow(H,[]);
hold on;
plot(peaks(:,2),peaks(:,1),'ro');

figure(3);
lines = houghlines(imageEdge,theta,rho,peaks,'FillGap',5,'MinLength',7);
max_len = 0;
for k = 1:length(lines)
   xy = [lines(k).point1; lines(k).point2];
   plot(xy(:,1),xy(:,2),'LineWidth',2,'Color','green'); hold on

   % Plot beginnings and ends of lines
   plot(xy(1,1),xy(1,2),'x','LineWidth',2,'Color','yellow'); hold on
   plot(xy(2,1),xy(2,2),'x','LineWidth',2,'Color','red'); hold on

   % Determine the endpoints of the longest line segment
   len = norm(lines(k).point1 - lines(k).point2);
   if ( len > max_len)
      max_len = len;
      xy_long = xy;
   end
end
%%
%czyścimy zmienne
clearvars;
clear all;
clc;

image = imread('lab112.png');

figure(1);
subplot(1,3,1); imshow(image);

image = im2bw(image,0.4);
image = imcomplement(image);

SE = ones(1,100);
imageEroded = imerode(image,SE);
image = imreconstruct(imageEroded,image);

image = imcomplement(image);

subplot(1,3,2); imshow(image);

image = edge(image,'sobel');

subplot(1,3,3); imshow(image);

[H,theta,rho] = hough(image,'RhoResolution',1,'ThetaResolution',1);
peaks = houghpeaks(H,8);

figure(2);
imshow(H,[]);
hold on;
plot(peaks(:,2),peaks(:,1),'ro');

figure(3);
lines = houghlines(image,theta,rho,peaks);
max_len = 0;
for k = 1:length(lines)
   xy = [lines(k).point1; lines(k).point2];
   plot(xy(:,1),xy(:,2),'LineWidth',2,'Color','green'); hold on

   % Plot beginnings and ends of lines
   plot(xy(1,1),xy(1,2),'x','LineWidth',2,'Color','yellow'); hold on
   plot(xy(2,1),xy(2,2),'x','LineWidth',2,'Color','red'); hold on

   % Determine the endpoints of the longest line segment
   len = norm(lines(k).point1 - lines(k).point2);
   if ( len > max_len)
      max_len = len;
      xy_long = xy;
   end
end

%%
%czyścimy zmienne
clearvars;
clear all;
clc;

image = imread('dom.png');

figure(1);
subplot(1,3,1); imshow(image);

image = im2bw(image,0.4);
image = imcomplement(image);

SE = ones(1,100);
imageEroded = imerode(image,SE);
image = imreconstruct(imageEroded,image);

image = imcomplement(image);

subplot(1,3,2); imshow(image);

image = edge(image,'sobel');

subplot(1,3,3); imshow(image);

[H,theta,rho] = hough(image,'RhoResolution',1,'ThetaResolution',1);
peaks = houghpeaks(H,13);

figure(2);
imshow(H,[]);
hold on;
plot(peaks(:,2),peaks(:,1),'ro');

figure(3);
lines = houghlines(image,theta,rho,peaks);
imshow(image); hold on;
max_len = 0;
for k = 1:length(lines)
   xy = [lines(k).point1; lines(k).point2];
   plot(xy(:,1),xy(:,2),'LineWidth',2,'Color','green'); hold on

   % Plot beginnings and ends of lines
   plot(xy(1,1),xy(1,2),'x','LineWidth',2,'Color','yellow'); hold on
   plot(xy(2,1),xy(2,2),'x','LineWidth',2,'Color','red'); hold on

   % Determine the endpoints of the longest line segment
   len = norm(lines(k).point1 - lines(k).point2);
   if ( len > max_len)
      max_len = len;
      xy_long = xy;
   end
end

%%
%czyścimy zmienne
clearvars;
clear all;
clc;

image = zeros(4,4);
image(2,1) = 1;
image(2,2) = 1;
image(2,3) = 1;
image(2,4) = 1;

myHoughImage = myHough(image,-100,100,0.5,-100,100,0.5);

subplot(1,2,1); imshow(image);
subplot(1,2,2); imshow(myHoughImage,[]);

%%

function AB = myHough(image,aMin,aMax,aSkok,bMin,bMax,bSkok)
    AB = zeros(abs(aMax-aMin)/aSkok + 1,abs(bMax-bMin)/bSkok + 1);
    a_v = aMin:aSkok:aMax;
    b_v = bMin:bSkok:bMax;
    [Y X] = size(image);
    size(AB)
    for I=1:Y
        for J=1:X
            if(image(I,J) == 1)
                for aa=1:length(a_v)
                    b = (Y-I) - a_v(aa)*J;
                    [v bb] = min( abs(b_v - b));
                    AB(aa,bb) = AB(aa,bb) + 1;
                end
            end
        end
    end
end